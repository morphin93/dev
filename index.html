<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion avec TON Keeper</title>
    <!-- Inclure le script TonConnect UI -->
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="tonweb.js"></script>
</head>
<body>
    <h1>Interagir avec un Smart Contract sur TON 9</h1>
    <!-- Bouton de connexion TON Keeper -->
    <div id="ton-connect"></div>
    <br>
    <!-- Boutons d'incrémentation et de lecture (sans l'attribut disabled) -->
     
    <button id="get-counter-btn">Obtenir la Valeur du Compteur</button>
    <p id="counter-value"></p>

    <script>
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://raw.githubusercontent.com/morphin93/dev/refs/heads/main/tonconnect-manifest.json',
            buttonRootId: 'ton-connect'
        });

        
        const counterValueElement = document.getElementById('counter-value');

        const contractAddress = 'EQDcR3pfOO45NGNbWChbCgKwB-sGDJDdC-0lE1NtjZfOlfx0';
        const tonweb = new window.TonWeb(new TonWeb.HttpProvider('https://testnet.toncenter.com/api/v2/jsonRPC'));

        // Créer une instance de l'adresse du contrat
        const contract = new tonweb.Contract({
            address: new TonWeb.utils.Address(contractAddress),
            provider: tonweb.provider,
        });

 

        // Fonction pour appeler le getter et obtenir la valeur du compteur
        async function getCounterValue() {
            console.log('Appel du getter pour obtenir la valeur du compteur...');
            try {
                const result = await contract.methods.get({}).call();
                const counterValue = result.value; // Remplacez par le champ correct de la valeur renvoyée.
                console.log('Valeur actuelle du compteur:', counterValue);
                counterValueElement.innerText = 'Valeur actuelle du compteur : ' + counterValue;
            } catch (error) {
                console.error('Erreur lors de l\'appel du getter:', error);
                alert('Erreur lors de l\'appel du getter');
            }
        }
 
        getCounterButton.addEventListener('click', getCounterValue);

        
    </script>
</body>
</html>

